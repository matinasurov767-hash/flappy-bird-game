<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flappy Bird by Matin</title>
    
    <!-- PWA –º–∞–Ω–∏—Ñ–µ—Å—Ç -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#1E90FF">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.80.1/dist/phaser.js"></script>
    <style>
        body { 
            margin: 0; 
            padding: 0; 
            background: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
            font-family: 'Arial', sans-serif;
        }
        #game-container {
            max-width: 100%;
            max-height: 100%;
            position: relative;
        }
        #ad-container {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 107, 107, 0.9);
            color: white;
            padding: 8px 16px;
            border-radius: 15px;
            font-size: 12px;
            z-index: 1000;
            display: none;
        }
        #sound-toggle {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.5);
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            font-size: 16px;
            cursor: pointer;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div id="game-container"></div>
    <div id="ad-container">–†–µ–∫–ª–∞–º–∞ ¬∑ –ü–æ–¥–¥–µ—Ä–∂–∏—Ç–µ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞</div>
    <button id="sound-toggle">üîä</button>
    
    <script>
        // =============================================
        // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø
        // =============================================
        let tg = null;
        if (window.Telegram && window.Telegram.WebApp) {
            tg = window.Telegram.WebApp;
            tg.ready();
            tg.expand();
        }

        // =============================================
        // –ú–ï–ù–ï–î–ñ–ï–† –†–ï–ö–õ–ê–ú–´
        // =============================================
        class AdManager {
            constructor() {
                this.adInterval = 3;
                this.gamesPlayed = 0;
                this.adContainer = document.getElementById('ad-container');
            }

            showInterstitial() {
                this.gamesPlayed++;
                if (this.gamesPlayed >= this.adInterval) {
                    this.gamesPlayed = 0;
                    this.showAd();
                }
            }

            showAd() {
                this.adContainer.style.display = 'block';
                this.adContainer.textContent = '–†–µ–∫–ª–∞–º–∞ ¬∑ –ü–æ–¥–¥–µ—Ä–∂–∏—Ç–µ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ Matin';
                
                setTimeout(() => {
                    this.adContainer.style.display = 'none';
                }, 5000);
            }
        }

        const adManager = new AdManager();

        // =============================================
        // –ú–ï–ù–ï–î–ñ–ï–† –ó–í–£–ö–ê
        // =============================================
        class SoundManager {
            constructor() {
                this.sounds = {};
                this.muted = false;
                this.soundToggle = document.getElementById('sound-toggle');
                this.backgroundMusic = null;
                
                this.soundToggle.addEventListener('click', () => {
                    this.toggleMute();
                });

                this.initializeSounds();
            }

            initializeSounds() {
                this.addSound('flap', { audio: 'sounds/flap.wav', volume: 0.3 });
                this.addSound('score', { audio: 'sounds/score.wav', volume: 0.5 });
                this.addSound('hit', { audio: 'sounds/hit.wav', volume: 0.7 });
                this.addSound('background', { audio: 'sounds/background.mp3', volume: 0.2 });
            }

            addSound(key, config) {
                this.sounds[key] = config;
            }

            playSound(key, volume = 1) {
                if (this.muted) return;
                
                const sound = this.sounds[key];
                if (sound && sound.audio) {
                    const audio = new Audio(sound.audio);
                    audio.volume = volume * (sound.volume || 1);
                    audio.play().catch(e => console.log('Audio play failed:', e));
                }
            }

            playBackgroundMusic() {
                if (this.muted) return;
                
                const bgSound = this.sounds['background'];
                if (bgSound && !this.backgroundMusic) {
                    this.backgroundMusic = new Audio(bgSound.audio);
                    this.backgroundMusic.volume = bgSound.volume || 0.3;
                    this.backgroundMusic.loop = true;
                    this.backgroundMusic.play().catch(e => console.log('Background music play failed:', e));
                }
            }

            stopBackgroundMusic() {
                if (this.backgroundMusic) {
                    this.backgroundMusic.pause();
                    this.backgroundMusic.currentTime = 0;
                    this.backgroundMusic = null;
                }
            }

            toggleMute() {
                this.muted = !this.muted;
                this.soundToggle.textContent = this.muted ? 'üîá' : 'üîä';
                
                if (this.muted) {
                    this.stopBackgroundMusic();
                } else {
                    this.playBackgroundMusic();
                }
            }
        }

        const soundManager = new SoundManager();

        // =============================================
        // –ú–ï–ù–ï–î–ñ–ï–† –û–ù–õ–ê–ô–ù –¢–ê–ë–õ–ò–¶–´ –õ–ò–î–ï–†–û–í
        // =============================================
        class OnlineLeaderboardManager {
            constructor() {
                // –ó–ê–ú–ï–ù–ò–¢–ï –ù–ê –í–ê–® –†–ï–ê–õ–¨–ù–´–ô URL –°–ï–†–í–ï–†–ê
                this.apiUrl = 'https://flappy-bird-server-3lu594fqo-matins-projects-55555d9d.vercel.app/api';
                this.leaderboard = [];
                this.userRank = 0;
            }

            async submitScore(score, userData) {
                try {
                    if (!tg || !tg.initDataUnsafe.user) {
                        console.log('Telegram user data not available');
                        return;
                    }

                    const response = await fetch(`${this.apiUrl}/leaderboard`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            score: score,
                            user_id: tg.initDataUnsafe.user.id,
                            first_name: tg.initDataUnsafe.user.first_name,
                            last_name: tg.initDataUnsafe.user.last_name || '',
                            username: tg.initDataUnsafe.user.username || '',
                            difficulty: userData.difficulty
                        })
                    });

                    if (!response.ok) {
                        throw new Error('Failed to submit score');
                    }

                    return await response.json();
                } catch (error) {
                    console.error('Error submitting score:', error);
                }
            }

            async getLeaderboard() {
                try {
                    const userId = tg?.initDataUnsafe?.user?.id || '';
                    const response = await fetch(`${this.apiUrl}/leaderboard?user_id=${userId}`);
                    if (!response.ok) {
                        throw new Error('Failed to fetch leaderboard');
                    }
                    
                    const data = await response.json();
                    this.leaderboard = data.leaderboard || [];
                    this.userRank = data.userRank || 0;
                    
                    return this.leaderboard;
                } catch (error) {
                    console.error('Error fetching leaderboard:', error);
                    return this.getLocalLeaderboard();
                }
            }

            getLocalLeaderboard() {
                // Fallback –¥–∞–Ω–Ω—ã–µ –µ—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
                return [
                    { score: 50, user_id: 'bot1', first_name: '–ê–ª–µ–∫—Å', difficulty: 'medium' },
                    { score: 30, user_id: 'bot2', first_name: '–ú–∞—Ä–∏—è', difficulty: 'easy' },
                    { score: 20, user_id: 'bot3', first_name: '–ò–≤–∞–Ω', difficulty: 'hard' },
                    { score: 10, user_id: 'bot4', first_name: '–ï–ª–µ–Ω–∞', difficulty: 'medium' }
                ];
            }

            getUserRank() {
                return this.userRank;
            }
        }

        const onlineLeaderboard = new OnlineLeaderboardManager();

        // =============================================
        // –ú–ï–ù–ï–î–ñ–ï–† –°–¢–ê–¢–ò–°–¢–ò–ö–ò
        // =============================================
        class StatsManager {
            constructor() {
                this.bestScoreKey = 'flappyBestScore';
                this.gamesPlayedKey = 'flappyGamesPlayed';
                this.totalScoreKey = 'flappyTotalScore';
            }

            getBestScore() {
                return parseInt(localStorage.getItem(this.bestScoreKey)) || 0;
            }

            setBestScore(score) {
                const currentBest = this.getBestScore();
                if (score > currentBest) {
                    localStorage.setItem(this.bestScoreKey, score);
                    return true;
                }
                return false;
            }

            incrementGamesPlayed() {
                const games = parseInt(localStorage.getItem(this.gamesPlayedKey)) || 0;
                localStorage.setItem(this.gamesPlayedKey, games + 1);
            }
        }

        const statsManager = new StatsManager();

        // =============================================
        // –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –ò–ì–†–´ PHAZER
        // =============================================
        const config = {
            type: Phaser.AUTO,
            parent: 'game-container',
            width: 360,
            height: 640,
            physics: { 
                default: 'arcade', 
                arcade: { 
                    gravity: { y: 800 },
                    debug: false
                } 
            },
            scale: {
                mode: Phaser.Scale.FIT,
                autoCenter: Phaser.Scale.CENTER_BOTH
            }
        };

        const game = new Phaser.Game(config);

        // =============================================
        // –°–¶–ï–ù–ê –ó–ê–°–¢–ê–í–ö–ò
        // =============================================
        class SplashScene extends Phaser.Scene {
            constructor() {
                super({ key: 'SplashScene' });
            }

            preload() {
                this.load.image('bird', 'assets/bird.png');
                this.load.image('pipe', 'assets/pipe.png');
                this.load.image('background', 'assets/background.png');

                const progressBox = this.add.graphics();
                progressBox.fillStyle(0x222222, 0.8);
                progressBox.fillRect(110, 270, 140, 30);

                const progressBar = this.add.graphics();
                
                this.load.on('progress', (value) => {
                    progressBar.clear();
                    progressBar.fillStyle(0x1E90FF, 1);
                    progressBar.fillRect(115, 275, 130 * value, 20);
                });

                this.load.on('complete', () => {
                    progressBar.destroy();
                    progressBox.destroy();
                });
            }

            create() {
                this.cameras.main.setBackgroundColor(0x1a1a2e);

                this.add.text(config.width/2, 150, 'FLAPPY BIRD', {
                    fontSize: '32px',
                    fill: '#FFD700',
                    fontStyle: 'bold'
                }).setOrigin(0.5);

                this.add.text(config.width/2, 190, 'by MATIN', {
                    fontSize: '18px',
                    fill: '#FFFFFF'
                }).setOrigin(0.5);

                const bestScore = statsManager.getBestScore();
                this.add.text(config.width/2, 230, `–†–µ–∫–æ—Ä–¥: ${bestScore}`, {
                    fontSize: '16px',
                    fill: '#CCCCCC'
                }).setOrigin(0.5);

                // –í—ã–±–æ—Ä —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
                const difficulties = ['easy', 'medium', 'hard'];
                const difficultyLabels = ['–õ—ë–≥–∫–∏–π', '–°—Ä–µ–¥–Ω–∏–π', '–°–ª–æ–∂–Ω—ã–π'];
                let selectedDifficulty = 'medium';

                for (let i = 0; i < difficulties.length; i++) {
                    const diffButton = this.add.text(config.width/2, 280 + i * 50, difficultyLabels[i], {
                        fontSize: '20px',
                        fill: '#FFFFFF',
                        backgroundColor: difficulties[i] === selectedDifficulty ? '#1565C0' : '#1E90FF',
                        padding: { x: 20, y: 10 }
                    }).setOrigin(0.5).setInteractive();

                    diffButton.on('pointerover', () => diffButton.setBackgroundColor('#1565C0'));
                    diffButton.on('pointerout', () => diffButton.setBackgroundColor(difficulties[i] === selectedDifficulty ? '#1565C0' : '#1E90FF'));
                    diffButton.on('pointerdown', () => {
                        this.children.list.forEach(child => {
                            if (child.text && difficultyLabels.includes(child.text)) {
                                const index = difficultyLabels.indexOf(child.text);
                                child.setBackgroundColor(difficulties[index] === selectedDifficulty ? '#1565C0' : '#1E90FF');
                            }
                        });
                        selectedDifficulty = difficulties[i];
                        diffButton.setBackgroundColor('#1565C0');
                    });
                }

                // –ö–Ω–æ–ø–∫–∞ –Ω–∞—á–∞–ª–∞ –∏–≥—Ä—ã
                const startButton = this.add.text(config.width/2, 450, '–ù–ê–ß–ê–¢–¨ –ò–ì–†–£', {
                    fontSize: '20px',
                    fill: '#FFFFFF',
                    backgroundColor: '#1E90FF',
                    padding: { x: 20, y: 10 }
                }).setOrigin(0.5).setInteractive();

                startButton.on('pointerover', () => startButton.setBackgroundColor('#1565C0'));
                startButton.on('pointerout', () => startButton.setBackgroundColor('#1E90FF'));
                startButton.on('pointerdown', () => {
                    this.startGame(selectedDifficulty);
                });

                // –ö–Ω–æ–ø–∫–∞ –æ–Ω–ª–∞–π–Ω —Ç–∞–±–ª–∏—Ü—ã –ª–∏–¥–µ—Ä–æ–≤
                const leaderboardButton = this.add.text(config.width/2, 520, '–û–ù–õ–ê–ô–ù –¢–ê–ë–õ–ò–¶–ê', {
                    fontSize: '16px',
                    fill: '#FFFFFF',
                    backgroundColor: '#1E90FF',
                    padding: { x: 15, y: 8 }
                }).setOrigin(0.5).setInteractive();

                leaderboardButton.on('pointerover', () => leaderboardButton.setBackgroundColor('#1565C0'));
                leaderboardButton.on('pointerout', () => leaderboardButton.setBackgroundColor('#1E90FF'));
                leaderboardButton.on('pointerdown', () => {
                    this.scene.start('OnlineLeaderboardScene');
                });

                this.time.delayedCall(10000, () => {
                    this.startGame(selectedDifficulty);
                });
            }

            startGame(difficulty) {
                statsManager.incrementGamesPlayed();
                this.scene.start('MainGame', { difficulty: difficulty });
            }
        }

        // =============================================
        // –û–°–ù–û–í–ù–ê–Ø –ò–ì–†–ê
        // =============================================
        class MainGame extends Phaser.Scene {
            constructor() {
                super({ key: 'MainGame' });
            }

            init(data) {
                this.score = 0;
                this.gameOver = false;
                this.pipeTimer = null;
                this.difficulty = data.difficulty || 'medium';
                this.pipeSpeed = this.difficulty === 'easy' ? -150 : this.difficulty === 'hard' ? -250 : -200;
                this.gap = this.difficulty === 'easy' ? 220 : this.difficulty === 'hard' ? 140 : 180;
            }

            create() {
                this.add.image(config.width/2, config.height/2, 'background')
                    .setDisplaySize(config.width, config.height);

                this.bird = this.physics.add.sprite(80, config.height/2, 'bird');
                this.bird.setCollideWorldBounds(true);
                
                this.pipes = this.physics.add.group();
                this.physics.add.collider(this.bird, this.pipes, this.hitPipe, null, this);
                
                this.scoreText = this.add.text(20, 20, '–°—á—ë—Ç: 0', { 
                    fontSize: '20px', 
                    fill: '#FFF',
                    stroke: '#000',
                    strokeThickness: 4
                });

                this.bestScore = statsManager.getBestScore();
                this.bestScoreText = this.add.text(20, 50, '–†–µ–∫–æ—Ä–¥: ' + this.bestScore, { 
                    fontSize: '14px', 
                    fill: '#FFD700'
                });
                
                const difficultyText = this.difficulty === 'easy' ? '–õ—ë–≥–∫–∏–π' : this.difficulty === 'hard' ? '–°–ª–æ–∂–Ω—ã–π' : '–°—Ä–µ–¥–Ω–∏–π';
                this.difficultyText = this.add.text(20, 80, '–°–ª–æ–∂–Ω–æ—Å—Ç—å: ' + difficultyText, { 
                    fontSize: '14px', 
                    fill: '#FFFFFF'
                });
                
                this.input.on('pointerdown', this.flap, this);
                
                this.pipeTimer = this.time.addEvent({ 
                    delay: 1500, 
                    callback: this.addPipe, 
                    callbackScope: this, 
                    loop: true 
                });

                soundManager.playBackgroundMusic();
            }

            update() {
                if (this.gameOver) return;
                
                // –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –û–®–ò–ë–ö–ê: –±—ã–ª–æ this.bird.body.velocity y, –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å this.bird.body.velocity.y
                if (this.bird.body.velocity.y < 0) {
                    this.bird.rotation = -0.3;
                } else {
                    this.bird.rotation = Phaser.Math.Clamp(this.bird.body.velocity.y / 400, -0.3, 0.5);
                }
                
                if (this.bird.y > config.height - 10 || this.bird.y < -10) {
                    this.endGame();
                }
                
                this.pipes.children.iterate(pipe => {
                    if (!pipe.passed && pipe.x < this.bird.x - 10) {
                        pipe.passed = true;
                        this.score += 0.5;
                        this.scoreText.setText('–°—á—ë—Ç: ' + Math.floor(this.score));
                        soundManager.playSound('score');
                    }
                });
            }

            flap() {
                if (this.gameOver) return;
                this.bird.setVelocityY(-350);
                soundManager.playSound('flap');
            }

            addPipe() {
                if (this.gameOver) return;
                
                const holePosition = Phaser.Math.Between(120, config.height - 120);
                
                const topPipe = this.pipes.create(config.width, holePosition - this.gap/2, 'pipe');
                topPipe.setOrigin(0.5, 1);
                topPipe.setImmovable(true);
                topPipe.body.allowGravity = false;
                topPipe.setVelocityX(this.pipeSpeed);
                
                const bottomPipe = this.pipes.create(config.width, holePosition + this.gap/2, 'pipe');
                bottomPipe.setOrigin(0.5, 0);
                bottomPipe.setImmovable(true);
                bottomPipe.body.allowGravity = false;
                bottomPipe.setVelocityX(this.pipeSpeed);
            }

            hitPipe() {
                if (!this.gameOver) {
                    this.endGame();
                }
            }

            endGame() {
                if (this.gameOver) return;
                
                this.gameOver = true;
                this.bird.setTint(0xFF0000);
                
                if (this.pipeTimer) {
                    this.pipeTimer.remove();
                }
                
                this.pipes.children.iterate(pipe => {
                    pipe.setVelocityX(0);
                });
                
                soundManager.playSound('hit');
                
                const finalScore = Math.floor(this.score);
                const isNewRecord = statsManager.setBestScore(finalScore);
                
                // –û–¢–ü–†–ê–í–õ–Ø–ï–ú –†–ï–ó–£–õ–¨–¢–ê–¢ –ù–ê –°–ï–†–í–ï–†
                onlineLeaderboard.submitScore(finalScore, {
                    difficulty: this.difficulty
                });
                
                this.time.delayedCall(1000, () => {
                    this.scene.start('GameOverScene', { 
                        score: finalScore,
                        bestScore: Math.max(finalScore, this.bestScore),
                        isNewRecord: isNewRecord,
                        difficulty: this.difficulty
                    });
                });
            }

            shutdown() {
                if (this.pipeTimer) {
                    this.pipeTimer.remove();
                }
                this.pipes.clear(true, true);
                soundManager.stopBackgroundMusic();
            }
        }

        // =============================================
        // –°–¶–ï–ù–ê –ö–û–ù–¶–ê –ò–ì–†–´
        // =============================================
        class GameOverScene extends Phaser.Scene {
            constructor() {
                super({ key: 'GameOverScene' });
            }

            init(data) {
                this.score = data.score;
                this.bestScore = data.bestScore;
                this.isNewRecord = data.isNewRecord;
                this.difficulty = data.difficulty;
            }

            create() {
                const overlay = this.add.rectangle(0, 0, config.width, config.height, 0x000000, 0.7);
                overlay.setOrigin(0);

                const panel = this.add.graphics();
                panel.fillStyle(0x1a1a2e, 1);
                panel.fillRoundedRect(config.width/2 - 120, config.height/2 - 120, 240, 240, 10);

                this.add.text(config.width/2, config.height/2 - 90, '–ò–ì–†–ê –û–ö–û–ù–ß–ï–ù–ê', {
                    fontSize: '20px',
                    fill: '#FF6B6B',
                    fontStyle: 'bold'
                }).setOrigin(0.5);

                if (this.isNewRecord) {
                    this.add.text(config.width/2, config.height/2 - 50, '–ù–û–í–´–ô –†–ï–ö–û–†–î!', {
                        fontSize: '18px',
                        fill: '#FFD700',
                        fontStyle: 'bold'
                    }).setOrigin(0.5);
                }

                this.add.text(config.width/2, config.height/2 - 20, '–°—á—ë—Ç: ' + this.score, {
                    fontSize: '24px',
                    fill: '#FFD700'
                }).setOrigin(0.5);

                this.add.text(config.width/2, config.height/2 + 10, '–†–µ–∫–æ—Ä–¥: ' + this.bestScore, {
                    fontSize: '18px',
                    fill: '#1E90FF'
                }).setOrigin(0.5);

                const restartButton = this.add.text(config.width/2, config.height/2 + 50, '–ò–ì–†–ê–¢–¨ –°–ù–û–í–ê', {
                    fontSize: '16px',
                    fill: '#FFFFFF',
                    backgroundColor: '#1E90FF',
                    padding: { x: 15, y: 8 }
                }).setOrigin(0.5).setInteractive();

                const leaderboardButton = this.add.text(config.width/2, config.height/2 + 90, '–û–ù–õ–ê–ô–ù –¢–ê–ë–õ–ò–¶–ê', {
                    fontSize: '16px',
                    fill: '#FFFFFF',
                    backgroundColor: '#1E90FF',
                    padding: { x: 15, y: 8 }
                }).setOrigin(0.5).setInteractive();

                const menuButton = this.add.text(config.width/2, config.height/2 + 130, '–í –ú–ï–ù–Æ', {
                    fontSize: '14px',
                    fill: '#CCCCCC',
                    backgroundColor: '#333333',
                    padding: { x: 15, y: 6 }
                }).setOrigin(0.5).setInteractive();

                restartButton.on('pointerover', () => restartButton.setBackgroundColor('#1565C0'));
                restartButton.on('pointerout', () => restartButton.setBackgroundColor('#1E90FF'));
                restartButton.on('pointerdown', () => {
                    adManager.showInterstitial();
                    this.scene.start('MainGame', { difficulty: this.difficulty });
                });

                leaderboardButton.on('pointerover', () => leaderboardButton.setBackgroundColor('#1565C0'));
                leaderboardButton.on('pointerout', () => leaderboardButton.setBackgroundColor('#1E90FF'));
                leaderboardButton.on('pointerdown', () => {
                    this.scene.start('OnlineLeaderboardScene');
                });

                menuButton.on('pointerover', () => menuButton.setBackgroundColor('#555555'));
                menuButton.on('pointerout', () => menuButton.setBackgroundColor('#333333'));
                menuButton.on('pointerdown', () => {
                    this.scene.start('SplashScene');
                });
            }
        }

        // =============================================
        // –°–¶–ï–ù–ê –û–ù–õ–ê–ô–ù –¢–ê–ë–õ–ò–¶–´ –õ–ò–î–ï–†–û–í
        // =============================================
        class OnlineLeaderboardScene extends Phaser.Scene {
            constructor() {
                super({ key: 'OnlineLeaderboardScene' });
            }

            async create() {
                this.cameras.main.setBackgroundColor(0x1a1a2e);

                const title = this.add.text(config.width/2, 50, '–û–ù–õ–ê–ô–ù –¢–ê–ë–õ–ò–¶–ê –õ–ò–î–ï–†–û–í', {
                    fontSize: '24px',
                    fill: '#FFD700',
                    fontStyle: 'bold'
                }).setOrigin(0.5);

                const backButton = this.add.text(30, 30, '‚Üê –ù–∞–∑–∞–¥', {
                    fontSize: '16px',
                    fill: '#FFFFFF',
                    backgroundColor: '#1E90FF',
                    padding: { x: 10, y: 5 }
                }).setOrigin(0).setInteractive();

                backButton.on('pointerover', () => backButton.setBackgroundColor('#1565C0'));
                backButton.on('pointerout', () => backButton.setBackgroundColor('#1E90FF'));
                backButton.on('pointerdown', () => {
                    this.scene.start('SplashScene');
                });

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥–ª—É—à–∫—É –∑–∞–≥—Ä—É–∑–∫–∏
                const loadingText = this.add.text(config.width/2, config.height/2, '–ó–∞–≥—Ä—É–∑–∫–∞...', {
                    fontSize: '18px',
                    fill: '#FFFFFF'
                }).setOrigin(0.5);

                try {
                    const leaderboard = await onlineLeaderboard.getLeaderboard();
                    loadingText.destroy();

                    // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ç–∞–±–ª–∏—Ü—É –ª–∏–¥–µ—Ä–æ–≤
                    this.displayLeaderboard(leaderboard);
                } catch (error) {
                    loadingText.setText('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏');
                    console.error(error);
                }
            }

            displayLeaderboard(leaderboard) {
                // –û–≥—Ä–∞–Ω–∏—á–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π, –Ω–∞–ø—Ä–∏–º–µ—Ä, 10
                const top10 = leaderboard.slice(0, 10);

                // –°–æ–∑–¥–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏ —Ç–∞–±–ª–∏—Ü—ã
                const headerY = 100;
                this.add.text(50, headerY, '–ú–µ—Å—Ç–æ', { fontSize: '16px', fill: '#FFD700' });
                this.add.text(120, headerY, '–ò–≥—Ä–æ–∫', { fontSize: '16px', fill: '#FFD700' });
                this.add.text(250, headerY, '–°—á—ë—Ç', { fontSize: '16px', fill: '#FFD700' });
                this.add.text(320, headerY, '–°–ª–æ–∂–Ω–æ—Å—Ç—å', { fontSize: '16px', fill: '#FFD700' });

                top10.forEach((entry, index) => {
                    const y = headerY + 30 + index * 30;
                    const rank = index + 1;
                    const playerName = entry.first_name + (entry.last_name ? ' ' + entry.last_name : '');
                    const score = entry.score;
                    const difficulty = entry.difficulty;

                    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ü–≤–µ—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –º–µ—Å—Ç–∞
                    let color = '#FFFFFF';
                    if (rank === 1) color = '#FFD700';
                    else if (rank === 2) color = '#C0C0C0';
                    else if (rank === 3) color = '#CD7F32';

                    this.add.text(50, y, rank, { fontSize: '14px', fill: color });
                    this.add.text(120, y, playerName, { fontSize: '14px', fill: color });
                    this.add.text(250, y, score, { fontSize: '14px', fill: color });
                    this.add.text(320, y, this.getDifficultyText(difficulty), { fontSize: '14px', fill: color });
                });

                // –ü–æ–∫–∞–∂–µ–º –º–µ—Å—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –µ—Å–ª–∏ –æ–Ω –Ω–µ –≤ —Ç–æ–ø-10
                const userRank = onlineLeaderboard.getUserRank();
                if (userRank > 10) {
                    const userEntry = leaderboard.find(entry => entry.user_id === tg?.initDataUnsafe?.user?.id);
                    if (userEntry) {
                        const y = headerY + 30 + 10 * 30 + 20;
                        this.add.text(50, y, userRank, { fontSize: '14px', fill: '#1E90FF' });
                        this.add.text(120, y, userEntry.first_name, { fontSize: '14px', fill: '#1E90FF' });
                        this.add.text(250, y, userEntry.score, { fontSize: '14px', fill: '#1E90FF' });
                        this.add.text(320, y, this.getDifficultyText(userEntry.difficulty), { fontSize: '14px', fill: '#1E90FF' });
                    }
                }
            }

            getDifficultyText(difficulty) {
                switch (difficulty) {
                    case 'easy': return '–õ—ë–≥–∫–∏–π';
                    case 'medium': return '–°—Ä–µ–¥–Ω–∏–π';
                    case 'hard': return '–°–ª–æ–∂–Ω—ã–π';
                    default: return '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
                }
            }
        }

        // =============================================
        // –ó–ê–ü–£–°–ö –°–¶–ï–ù
        // =============================================
        game.scene.add('SplashScene', SplashScene);
        game.scene.add('MainGame', MainGame);
        game.scene.add('GameOverScene', GameOverScene);
        game.scene.add('OnlineLeaderboardScene', OnlineLeaderboardScene);
        game.scene.start('SplashScene');
    </script>
</body>
</html>
